// src/handler.ts
import { handleRequest, indexTemplate } from "@shopify/hydrogen/platforms";
import staticPaths from "@static-manifest";
import { InMemoryCache } from "@shopify/hydrogen/cache/in-memory";
var memoryCache = new InMemoryCache();
globalThis.Oxygen || (globalThis.Oxygen = {});
globalThis.Oxygen.env = Deno.env.toObject();
var handler = async (request, context) => {
  const { pathname } = new URL(request.url);
  if (pathname.startsWith("/assets/") || staticPaths.has(pathname)) {
    return;
  }
  const cache = "caches" in globalThis ? await caches.open("hydrogen") : memoryCache;
  request.headers.set("x-forwarded-for", context.ip);
  const waitUntil = () => {
  };
  try {
    return await handleRequest(request, {
      indexTemplate,
      context: { waitUntil, ...context },
      cache
    });
  } catch (error) {
    return new Response(error.message || error.toString(), { status: 500 });
  }
};
var handler_default = handler;
export {
  handler_default as default
};
