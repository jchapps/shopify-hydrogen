{"version":3,"file":"25e7211a.js","sources":["../../../node_modules/@shopify/hydrogen/dist/esnext/foundation/Analytics/connectors/Shopify/utils.js","../../../node_modules/@shopify/hydrogen/dist/esnext/foundation/Analytics/connectors/Shopify/const.js","../../../node_modules/@shopify/hydrogen/dist/esnext/foundation/Analytics/connectors/Shopify/customer-events.client.js","../../../node_modules/@shopify/hydrogen/dist/esnext/foundation/Analytics/connectors/Shopify/ShopifyAnalytics.client.js"],"sourcesContent":["const zeros = '00000000';\nconst tokenHash = 'xxxx-4xxx-xxxx-xxxxxxxxxxxx';\nexport function buildUUID() {\n    let hash = '';\n    try {\n        const crypto = window.crypto;\n        const randomValuesArray = new Uint16Array(31);\n        crypto.getRandomValues(randomValuesArray);\n        // Generate a strong UUID\n        let i = 0;\n        hash = tokenHash\n            .replace(/[x]/g, (c, ...args) => {\n            const r = randomValuesArray[i] % 16;\n            const v = c === 'x' ? r : (r & 0x3) | 0x8;\n            i++;\n            return v.toString(16);\n        })\n            .toUpperCase();\n    }\n    catch (err) {\n        // crypto not available, generate weak UUID\n        hash = tokenHash\n            .replace(/[x]/g, (c, ...args) => {\n            const r = (Math.random() * 16) | 0;\n            const v = c === 'x' ? r : (r & 0x3) | 0x8;\n            return v.toString(16);\n        })\n            .toUpperCase();\n    }\n    return `${hexTime()}-${hash}`;\n}\nexport function hexTime() {\n    // 32 bit representations of new Date().getTime() and performance.now()\n    let dateNumber = 0;\n    let perfNumber = 0;\n    // Result of zero-fill right shift is always positive\n    dateNumber = new Date().getTime() >>> 0;\n    try {\n        perfNumber = performance.now() >>> 0;\n    }\n    catch (err) {\n        perfNumber = 0;\n    }\n    const output = Math.abs(dateNumber + perfNumber)\n        .toString(16)\n        .toLowerCase();\n    return zeros.substr(0, 8 - output.length) + output;\n}\nexport function stripGId(text = '') {\n    return parseInt(stripId(text));\n}\nexport function stripId(text = '') {\n    return text.substring(text.lastIndexOf('/') + 1);\n}\nexport function addDataIf(keyValuePairs, formattedData) {\n    Object.entries(keyValuePairs).forEach(([key, value]) => {\n        if (value) {\n            formattedData[key] = value;\n        }\n    });\n    return formattedData;\n}\nfunction getNavigationTypeExperimental() {\n    try {\n        const navigationEntries = performance?.getEntriesByType &&\n            performance?.getEntriesByType('navigation');\n        if (navigationEntries && navigationEntries[0]) {\n            //  https://developer.mozilla.org/en-US/docs/Web/API/PerformanceNavigationTiming\n            const rawType = window.performance.getEntriesByType('navigation')[0]['type'];\n            const navType = rawType && rawType.toString();\n            return navType;\n        }\n    }\n    catch (err) {\n        // Do nothing\n    }\n    return undefined;\n}\nfunction getNavigationTypeLegacy() {\n    try {\n        if (PerformanceNavigation &&\n            performance?.navigation?.type !== null &&\n            performance?.navigation?.type !== undefined) {\n            //  https://developer.mozilla.org/en-US/docs/Web/API/Performance/navigation\n            const rawType = performance.navigation.type;\n            switch (rawType) {\n                case PerformanceNavigation.TYPE_NAVIGATE:\n                    return 'navigate';\n                    break;\n                case PerformanceNavigation.TYPE_RELOAD:\n                    return 'reload';\n                    break;\n                case PerformanceNavigation.TYPE_BACK_FORWARD:\n                    return 'back_forward';\n                    break;\n                default:\n                    return `unknown: ${rawType}`;\n            }\n        }\n    }\n    catch (err) {\n        // do nothing\n    }\n    return undefined;\n}\nexport function getNavigationType() {\n    try {\n        let navApi = 'PerformanceNavigationTiming';\n        let navType = getNavigationTypeExperimental();\n        if (!navType) {\n            navType = getNavigationTypeLegacy();\n            navApi = 'performance.navigation';\n        }\n        if (navType) {\n            return [navType, navApi];\n        }\n        else {\n            return ['unknown', 'unknown'];\n        }\n    }\n    catch (err) {\n        // do nothing\n    }\n    return ['error', 'error'];\n}\n","// Shopify analytics constants\nconst article = 'article';\nconst blog = 'blog';\nconst captcha = 'captcha';\nconst cart = 'cart';\nconst collection = 'collection';\nconst customersAccount = 'customers/account';\nconst customersActivateAccount = 'customers/activate_account';\nconst customersAddresses = 'customers/addresses';\nconst customersLogin = 'customers/login';\nconst customersOrder = 'customers/order';\nconst customersRegister = 'customers/register';\nconst customersResetPassword = 'customers/reset_password';\nconst giftCard = 'gift_card';\nconst home = 'index';\nconst listCollections = 'list-collections';\nconst forbidden = '403';\nconst notFound = '404';\nconst page = 'page';\nconst password = 'password';\nconst product = 'product';\nconst policy = 'policy';\nconst search = 'search';\nexport const PAGE_RENDERED_EVENT_NAME = 'page_rendered';\nexport const COLLECTION_PAGE_RENDERED_EVENT_NAME = 'collection_page_rendered';\nexport const PRODUCT_PAGE_RENDERED_EVENT_NAME = 'product_page_rendered';\nexport const PRODUCT_ADDED_TO_CART_EVENT_NAME = 'product_added_to_cart';\nexport const SEARCH_SUBMITTED_EVENT_NAME = 'search_submitted';\nexport const ShopifyAnalyticsConstants = {\n    pageType: {\n        article,\n        blog,\n        captcha,\n        cart,\n        collection,\n        customersAccount,\n        customersActivateAccount,\n        customersAddresses,\n        customersLogin,\n        customersOrder,\n        customersRegister,\n        customersResetPassword,\n        giftCard,\n        home,\n        listCollections,\n        forbidden,\n        notFound,\n        page,\n        password,\n        product,\n        policy,\n        search,\n    },\n};\n","import { buildUUID, addDataIf, getNavigationType, stripGId, stripId, } from './utils.js';\nimport { ShopifyAnalyticsConstants, PAGE_RENDERED_EVENT_NAME, COLLECTION_PAGE_RENDERED_EVENT_NAME, PRODUCT_PAGE_RENDERED_EVENT_NAME, PRODUCT_ADDED_TO_CART_EVENT_NAME, SEARCH_SUBMITTED_EVENT_NAME, } from './const.js';\nimport { flattenConnection } from '../../../../utilities/flattenConnection/index.js';\nconst DOC_URL = 'https://shopify.dev/api/hydrogen/components/framework/shopifyanalytics';\nconst requiredProductFields = [\n    {\n        column: 'product_gid',\n        gqlField: 'product.id',\n    },\n    {\n        column: 'variant_gid',\n        gqlField: 'variant.id',\n    },\n    {\n        column: 'name',\n        gqlField: 'product.title',\n    },\n    {\n        column: 'variant',\n        gqlField: 'variant.title',\n    },\n    {\n        column: 'brand',\n        gqlField: 'product.vendor',\n    },\n    {\n        column: 'price',\n        gqlField: 'variant.priceV2.amount',\n    },\n];\nlet customerId = '';\nexport function trackCustomerPageView(payload, sendToServer) {\n    const shopify = payload.shopify;\n    const canonicalUrl = shopify.canonicalPath\n        ? `${location.origin}${shopify.canonicalPath}`\n        : location.href;\n    // Only the /account/index route sets the `customerId`, so we persist this value when it's available\n    // and append it to analytics events only when a customer is in the logged in state (provided by `CartProvider`).\n    if (payload.shopify.customerId) {\n        customerId = payload.shopify.customerId;\n    }\n    sendToServer(customerEventSchema(payload, PAGE_RENDERED_EVENT_NAME, {\n        canonical_url: canonicalUrl,\n    }));\n    if (shopify.pageType === ShopifyAnalyticsConstants.pageType.product) {\n        sendToServer(customerEventSchema(payload, PRODUCT_PAGE_RENDERED_EVENT_NAME, {\n            products: formatProductsJSON(shopify.products),\n            canonical_url: canonicalUrl,\n            total_value: parseFloat(shopify.products[0].price),\n        }));\n    }\n    if (shopify.pageType === ShopifyAnalyticsConstants.pageType.collection) {\n        sendToServer(customerEventSchema(payload, COLLECTION_PAGE_RENDERED_EVENT_NAME, {\n            collection_name: shopify.collectionHandle,\n            canonical_url: canonicalUrl,\n        }));\n    }\n    if (shopify.pageType === ShopifyAnalyticsConstants.pageType.search) {\n        sendToServer(customerEventSchema(payload, SEARCH_SUBMITTED_EVENT_NAME, {\n            search_string: shopify.searchTerm,\n        }));\n    }\n}\nexport function trackCustomerAddToCart(payload, sendToServer) {\n    const { totalValue, addedProducts } = getAddedProducts(payload);\n    sendToServer(customerEventSchema(payload, PRODUCT_ADDED_TO_CART_EVENT_NAME, {\n        total_value: totalValue,\n        products: formatProductsJSON(addedProducts),\n        cart_token: stripId(payload.cart.id),\n    }));\n}\nfunction customerEventSchema(payload, eventName, extraData) {\n    return {\n        schema_id: 'custom_storefront_customer_tracking/1.0',\n        payload: {\n            ...buildCustomerPayload(payload, extraData),\n            event_name: eventName,\n        },\n        metadata: {\n            event_created_at_ms: Date.now(),\n        },\n    };\n}\nfunction buildCustomerPayload(payload, extraData = {}) {\n    const location = document.location;\n    const shopify = payload.shopify;\n    const [navigation_type, navigation_api] = getNavigationType();\n    let formattedData = {\n        source: 'hydrogen',\n        shop_id: stripGId(shopify.shopId),\n        hydrogenSubchannelId: shopify.storefrontId || '0',\n        event_time: Date.now(),\n        event_id: buildUUID(),\n        unique_token: shopify.userId,\n        referrer: document.referrer,\n        event_source_url: location.href,\n        user_agent: navigator.userAgent,\n        navigation_type,\n        navigation_api,\n        currency: shopify.currency,\n        /**\n         * For now, all cookie consent management is manage by developers\n         *\n         * TO-DO: When we have access to consent api, implement is_persistent_cookie\n         *        according to the definition below\n         *\n         * It references the state of consent for GDPR protected visitors.\n         * If persistent === FALSE, it means that the merchant has set\n         * “Partially collected before consent”,  and the visitor has not consented.\n         * Until a user consents, we downgrade _shopify_y to a session cookie instead of 1yr expiry.\n         * It denotes a partially stable identifier (stable only for the length of the session,\n         * which should be until they close the browser).\n         */\n        is_persistent_cookie: true,\n        ccpa_enforced: false,\n        gdpr_enforced: false,\n    };\n    formattedData = addDataIf({\n        customer_id: shopify.isLoggedIn && stripGId(customerId),\n    }, formattedData);\n    formattedData = addDataIf(extraData, formattedData);\n    return formattedData;\n}\nfunction formatProductsJSON(products) {\n    if (!products || products.length === 0) {\n        throw Error(`Make sure useServerAnalytics returns \"products\"\\n More details at ${DOC_URL}#product\\n`);\n    }\n    const formattedProducts = products.map((p) => {\n        validateProductData(p, 'useServerAnalytics', 'column', 'product-page');\n        return JSON.stringify({\n            ...p,\n            product_id: stripGId(p.product_gid),\n            variant_id: stripGId(p.variant_gid),\n            quantity: Number(p.quantity || 0),\n        });\n    });\n    return formattedProducts;\n}\nfunction getAddedProducts(payload) {\n    const addedLines = payload.addedCartLines;\n    const cartLines = formatCartLinesByProductVariant(payload.cart.lines);\n    let totalValue = 0;\n    const addedProducts = addedLines.map((line) => {\n        const item = cartLines[line.merchandiseId];\n        totalValue += parseFloat(item.price) * (line.quantity || 0);\n        return {\n            ...item,\n            quantity: line.quantity,\n        };\n    });\n    return {\n        totalValue,\n        addedProducts,\n    };\n}\nfunction formatCartLinesByProductVariant(lines) {\n    const cartLines = flattenConnection(lines);\n    const cartItems = {};\n    cartLines.forEach((line) => {\n        const product = line.merchandise.product;\n        const variant = line.merchandise;\n        cartItems[line.merchandise.id] = {\n            product_gid: product.id,\n            variant_gid: variant.id,\n            name: product.title,\n            variant: variant.title,\n            brand: product.vendor,\n            category: product.productType,\n            price: variant.priceV2.amount,\n            sku: variant.sku,\n        };\n        validateProductData(cartItems[line.merchandise.id], 'cart fragment', 'gqlField', 'cart-fragment');\n    });\n    return cartItems;\n}\nfunction validateProductData(product, source, requireKey, docAnchor) {\n    requiredProductFields.forEach((field) => {\n        if (!product[field.column] || product[field.column] === '') {\n            throw Error(`Make sure ${source} returns \"${field[requireKey]}\"\\n More details at ${DOC_URL}#${docAnchor}\\n`);\n        }\n    });\n}\n","import { useEffect } from 'react';\nimport { parse, stringify } from 'worktop/cookie';\nimport { SHOPIFY_Y, SHOPIFY_S } from '../../../../constants.js';\nimport { ClientAnalytics } from '../../ClientAnalytics.js';\nimport { trackCustomerAddToCart, trackCustomerPageView, } from './customer-events.client.js';\nimport { buildUUID, addDataIf, stripGId } from './utils.js';\nconst longTermLength = 60 * 60 * 24 * 360 * 2; // ~2 year expiry\nconst shortTermLength = 60 * 30; // 30 mins\nconst myShopifyDomain = 'myshopify.com';\nconst oxygenDomain = 'myshopify.dev';\nlet isInit = false;\nlet microSessionCount = 0;\nexport function ShopifyAnalyticsClient({ cookieDomain }) {\n    useEffect(() => {\n        try {\n            // Find Shopify cookies\n            const cookieData = parse(document.cookie);\n            const shopifyYCookie = cookieData[SHOPIFY_Y] || buildUUID();\n            const shopifySCookie = cookieData[SHOPIFY_S] || buildUUID();\n            /**\n             * Set user and session cookies and refresh the expiry time\n             */\n            updateCookie(SHOPIFY_Y, shopifyYCookie, longTermLength, cookieDomain);\n            updateCookie(SHOPIFY_S, shopifySCookie, shortTermLength, cookieDomain);\n            ClientAnalytics.pushToPageAnalyticsData({\n                shopify: {\n                    pageId: buildUUID(),\n                    userId: shopifyYCookie,\n                    sessionId: shopifySCookie,\n                },\n            });\n            microSessionCount = 0;\n            // TODO: Fix with useEvent when ready\n            // RFC: https://github.com/reactjs/rfcs/blob/useevent/text/0000-useevent.md\n            if (!isInit) {\n                isInit = true;\n                const eventNames = ClientAnalytics.eventNames;\n                ClientAnalytics.subscribe(eventNames.PAGE_VIEW, trackPageView);\n                ClientAnalytics.subscribe(eventNames.ADD_TO_CART, trackAddToCart);\n                // On a slow network, the pageview event could be already fired before\n                // we subscribed to the pageview event\n                if (ClientAnalytics.hasSentFirstPageView()) {\n                    trackPageView(ClientAnalytics.getPageAnalyticsData());\n                }\n            }\n        }\n        catch (err) {\n            // Do nothing\n        }\n    });\n    return null;\n}\nfunction updateCookie(cookieName, value, maxage, cookieDomain) {\n    const cookieString = stringify(cookieName, value, {\n        maxage,\n        domain: getCookieDomain(cookieDomain),\n        secure: import.meta.env.PROD,\n        samesite: 'Lax',\n        path: '/',\n    });\n    document.cookie = cookieString;\n    return cookieString;\n}\nfunction getCookieDomain(cookieDomain) {\n    const hostname = location.hostname;\n    if (hostname.indexOf(myShopifyDomain) !== -1) {\n        return `.${hostname.split('.').slice(-3).join('.')}`;\n    }\n    else if (hostname.indexOf(cookieDomain) !== -1) {\n        return `.${cookieDomain}`;\n    }\n    else {\n        return '';\n    }\n}\nfunction trackPageView(payload) {\n    microSessionCount += 1;\n    try {\n        if (payload && payload.shopify) {\n            sendToServer(storefrontPageViewSchema(payload));\n            trackCustomerPageView(payload, sendToServer);\n        }\n    }\n    catch (error) {\n        console.error(`Error Shopify analytics: ${ClientAnalytics.eventNames.PAGE_VIEW}\\n`, error);\n    }\n}\nfunction storefrontPageViewSchema(payload) {\n    return {\n        schema_id: 'trekkie_storefront_page_view/1.4',\n        payload: buildStorefrontPageViewPayload(payload),\n        metadata: {\n            event_created_at_ms: Date.now(),\n        },\n    };\n}\nfunction buildStorefrontPageViewPayload(payload) {\n    const location = document.location;\n    const shopify = payload.shopify;\n    let formattedData = {\n        appClientId: '6167201',\n        hydrogenSubchannelId: shopify.storefrontId || '0',\n        isPersistentCookie: true,\n        uniqToken: shopify.userId,\n        visitToken: shopify.sessionId,\n        microSessionId: shopify.pageId,\n        microSessionCount,\n        url: location.href,\n        path: location.pathname,\n        search: location.search,\n        referrer: document.referrer,\n        title: document.title,\n        shopId: stripGId(shopify.shopId),\n        currency: shopify.currency,\n        contentLanguage: shopify.acceptedLanguage,\n    };\n    formattedData = addDataIf({\n        isMerchantRequest: isMerchantRequest(),\n        pageType: shopify.pageType,\n        customerId: shopify.customerId,\n    }, formattedData);\n    if (shopify.resourceId) {\n        try {\n            formattedData = addDataIf({\n                resourceType: getResourceType(shopify.resourceId),\n                resourceId: stripGId(shopify.resourceId),\n            }, formattedData);\n        }\n        catch (err) {\n            // do nothing\n        }\n    }\n    return formattedData;\n}\nfunction trackAddToCart(payload) {\n    microSessionCount += 1;\n    try {\n        if (payload && payload.shopify) {\n            trackCustomerAddToCart(payload, sendToServer);\n        }\n    }\n    catch (error) {\n        console.error(`Error Shopify analytics: ${ClientAnalytics.eventNames.ADD_TO_CART}\\n`, error);\n    }\n}\nfunction isMerchantRequest() {\n    const hostname = location.hostname;\n    if (hostname.indexOf(oxygenDomain) !== -1 || hostname === 'localhost') {\n        return true;\n    }\n    return false;\n}\nfunction getResourceType(text = '') {\n    return text\n        .substring(0, text.lastIndexOf('/'))\n        .replace(/.*shopify\\//, '')\n        .toLowerCase();\n}\nconst BATCH_SENT_TIMEOUT = 500;\nlet batchedData = [];\nlet batchedTimeout;\nfunction sendToServer(data) {\n    batchedData.push(data);\n    if (batchedTimeout) {\n        clearTimeout(batchedTimeout);\n        batchedTimeout = null;\n    }\n    batchedTimeout = setTimeout(() => {\n        const batchedDataToBeSent = {\n            events: batchedData,\n            metadata: {\n                event_sent_at_ms: Date.now(),\n            },\n        };\n        batchedData = [];\n        batchedTimeout = null;\n        // Send to Shopify\n        try {\n            fetch('https://monorail-edge.shopifysvc.com/unstable/produce_batch', {\n                method: 'post',\n                headers: {\n                    'content-type': 'text/plain',\n                },\n                body: JSON.stringify(batchedDataToBeSent),\n            });\n        }\n        catch (error) {\n            // Do nothing\n        }\n    }, BATCH_SENT_TIMEOUT);\n}\n"],"names":["zeros","tokenHash","buildUUID","hash","crypto","randomValuesArray","i","c","args","r","v","hexTime","dateNumber","perfNumber","output","stripGId","text","stripId","addDataIf","keyValuePairs","formattedData","key","value","getNavigationTypeExperimental","navigationEntries","rawType","getNavigationTypeLegacy","_a","_b","getNavigationType","navApi","navType","article","blog","captcha","cart","collection","customersAccount","customersActivateAccount","customersAddresses","customersLogin","customersOrder","customersRegister","customersResetPassword","giftCard","home","listCollections","forbidden","notFound","page","password","product","policy","search","PAGE_RENDERED_EVENT_NAME","COLLECTION_PAGE_RENDERED_EVENT_NAME","PRODUCT_PAGE_RENDERED_EVENT_NAME","PRODUCT_ADDED_TO_CART_EVENT_NAME","SEARCH_SUBMITTED_EVENT_NAME","ShopifyAnalyticsConstants","DOC_URL","requiredProductFields","customerId","trackCustomerPageView","payload","sendToServer","shopify","canonicalUrl","customerEventSchema","formatProductsJSON","trackCustomerAddToCart","totalValue","addedProducts","getAddedProducts","eventName","extraData","buildCustomerPayload","location","navigation_type","navigation_api","products","p","validateProductData","addedLines","cartLines","formatCartLinesByProductVariant","line","item","lines","flattenConnection","cartItems","variant","source","requireKey","docAnchor","field","longTermLength","shortTermLength","myShopifyDomain","oxygenDomain","isInit","microSessionCount","ShopifyAnalyticsClient","cookieDomain","useEffect","cookieData","parse","shopifyYCookie","SHOPIFY_Y","shopifySCookie","SHOPIFY_S","updateCookie","ClientAnalytics","eventNames","trackPageView","trackAddToCart","cookieName","maxage","cookieString","stringify","getCookieDomain","hostname","storefrontPageViewSchema","error","buildStorefrontPageViewPayload","isMerchantRequest","getResourceType","BATCH_SENT_TIMEOUT","batchedData","batchedTimeout","data","batchedDataToBeSent"],"mappings":"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"}