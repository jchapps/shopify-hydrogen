import{r as N,a as _,b as y,C as s}from"./index.40649654.js";import{u as w,l as k}from"./d6282b27.js";import{f as S}from"./92add5bc.js";const O="00000000",v="xxxx-4xxx-xxxx-xxxxxxxxxxxx";function p(){let e="";try{const r=window.crypto,t=new Uint16Array(31);r.getRandomValues(t);let n=0;e=v.replace(/[x]/g,(o,...c)=>{const a=t[n]%16,D=o==="x"?a:a&3|8;return n++,D.toString(16)}).toUpperCase()}catch{e=v.replace(/[x]/g,(t,...n)=>{const o=Math.random()*16|0;return(t==="x"?o:o&3|8).toString(16)}).toUpperCase()}return`${R()}-${e}`}function R(){let e=0,r=0;e=new Date().getTime()>>>0;try{r=performance.now()>>>0}catch{r=0}const t=Math.abs(e+r).toString(16).toLowerCase();return O.substr(0,8-t.length)+t}function i(e=""){return parseInt(x(e))}function x(e=""){return e.substring(e.lastIndexOf("/")+1)}function l(e,r){return Object.entries(e).forEach(([t,n])=>{n&&(r[t]=n)}),r}function V(){try{const e=(performance==null?void 0:performance.getEntriesByType)&&(performance==null?void 0:performance.getEntriesByType("navigation"));if(e&&e[0]){const r=window.performance.getEntriesByType("navigation")[0].type;return r&&r.toString()}}catch{}}function L(){var e,r;try{if(PerformanceNavigation&&((e=performance==null?void 0:performance.navigation)==null?void 0:e.type)!==null&&((r=performance==null?void 0:performance.navigation)==null?void 0:r.type)!==void 0){const t=performance.navigation.type;switch(t){case PerformanceNavigation.TYPE_NAVIGATE:return"navigate";case PerformanceNavigation.TYPE_RELOAD:return"reload";case PerformanceNavigation.TYPE_BACK_FORWARD:return"back_forward";default:return`unknown: ${t}`}}}catch{}}function q(){try{let e="PerformanceNavigationTiming",r=V();return r||(r=L(),e="performance.navigation"),r?[r,e]:["unknown","unknown"]}catch{}return["error","error"]}const F="article",M="blog",$="captcha",U="cart",B="collection",G="customers/account",Y="customers/activate_account",H="customers/addresses",J="customers/login",W="customers/order",j="customers/register",z="customers/reset_password",K="gift_card",Q="index",X="list-collections",Z="403",ee="404",te="page",re="password",ne="product",oe="policy",ce="search",ae="page_rendered",se="collection_page_rendered",ie="product_page_rendered",ue="product_added_to_cart",de="search_submitted",m={pageType:{article:F,blog:M,captcha:$,cart:U,collection:B,customersAccount:G,customersActivateAccount:Y,customersAddresses:H,customersLogin:J,customersOrder:W,customersRegister:j,customersResetPassword:z,giftCard:K,home:Q,listCollections:X,forbidden:Z,notFound:ee,page:te,password:re,product:ne,policy:oe,search:ce}},A="https://shopify.dev/api/hydrogen/components/framework/shopifyanalytics",pe=[{column:"product_gid",gqlField:"product.id"},{column:"variant_gid",gqlField:"variant.id"},{column:"name",gqlField:"product.title"},{column:"variant",gqlField:"variant.title"},{column:"brand",gqlField:"product.vendor"},{column:"price",gqlField:"variant.priceV2.amount"}];let P="";function le(e,r){const t=e.shopify,n=t.canonicalPath?`${location.origin}${t.canonicalPath}`:location.href;e.shopify.customerId&&(P=e.shopify.customerId),r(d(e,ae,{canonical_url:n})),t.pageType===m.pageType.product&&r(d(e,ie,{products:C(t.products),canonical_url:n,total_value:parseFloat(t.products[0].price)})),t.pageType===m.pageType.collection&&r(d(e,se,{collection_name:t.collectionHandle,canonical_url:n})),t.pageType===m.pageType.search&&r(d(e,de,{search_string:t.searchTerm}))}function fe(e,r){const{totalValue:t,addedProducts:n}=ge(e);r(d(e,ue,{total_value:t,products:C(n),cart_token:x(e.cart.id)}))}function d(e,r,t){return{schema_id:"custom_storefront_customer_tracking/1.0",payload:{...me(e,t),event_name:r},metadata:{event_created_at_ms:Date.now()}}}function me(e,r={}){const t=document.location,n=e.shopify,[o,c]=q();let a={source:"hydrogen",shop_id:i(n.shopId),hydrogenSubchannelId:n.storefrontId||"0",event_time:Date.now(),event_id:p(),unique_token:n.userId,referrer:document.referrer,event_source_url:t.href,user_agent:navigator.userAgent,navigation_type:o,navigation_api:c,currency:n.currency,is_persistent_cookie:!0,ccpa_enforced:!1,gdpr_enforced:!1};return a=l({customer_id:n.isLoggedIn&&i(P)},a),a=l(r,a),a}function C(e){if(!e||e.length===0)throw Error(`Make sure useServerAnalytics returns "products"
 More details at ${A}#product
`);return e.map(t=>(b(t,"useServerAnalytics","column","product-page"),JSON.stringify({...t,product_id:i(t.product_gid),variant_id:i(t.variant_gid),quantity:Number(t.quantity||0)})))}function ge(e){const r=e.addedCartLines,t=he(e.cart.lines);let n=0;const o=r.map(c=>{const a=t[c.merchandiseId];return n+=parseFloat(a.price)*(c.quantity||0),{...a,quantity:c.quantity}});return{totalValue:n,addedProducts:o}}function he(e){const r=S(e),t={};return r.forEach(n=>{const o=n.merchandise.product,c=n.merchandise;t[n.merchandise.id]={product_gid:o.id,variant_gid:c.id,name:o.title,variant:c.title,brand:o.vendor,category:o.productType,price:c.priceV2.amount,sku:c.sku},b(t[n.merchandise.id],"cart fragment","gqlField","cart-fragment")}),t}function b(e,r,t,n){pe.forEach(o=>{if(!e[o.column]||e[o.column]==="")throw Error(`Make sure ${r} returns "${o[t]}"
 More details at ${A}#${n}
`)})}const _e=60*60*24*360*2,ye=60*30,ve="myshopify.com",Te="myshopify.dev";let T=!1,f=0;function ke({cookieDomain:e}){return N.exports.useEffect(()=>{try{const r=w(document.cookie),t=r[_]||p(),n=r[y]||p();if(E(_,t,_e,e),E(y,n,ye,e),s.pushToPageAnalyticsData({shopify:{pageId:p(),userId:t,sessionId:n}}),f=0,!T){T=!0;const o=s.eventNames;s.subscribe(o.PAGE_VIEW,I),s.subscribe(o.ADD_TO_CART,Ae),s.hasSentFirstPageView()&&I(s.getPageAnalyticsData())}}catch{}}),null}function E(e,r,t,n){const o=k(e,r,{maxage:t,domain:Ee(n),secure:!0,samesite:"Lax",path:"/"});return document.cookie=o,o}function Ee(e){const r=location.hostname;return r.indexOf(ve)!==-1?`.${r.split(".").slice(-3).join(".")}`:r.indexOf(e)!==-1?`.${e}`:""}function I(e){f+=1;try{e&&e.shopify&&(h(Ie(e)),le(e,h))}catch(r){console.error(`Error Shopify analytics: ${s.eventNames.PAGE_VIEW}
`,r)}}function Ie(e){return{schema_id:"trekkie_storefront_page_view/1.4",payload:xe(e),metadata:{event_created_at_ms:Date.now()}}}function xe(e){const r=document.location,t=e.shopify;let n={appClientId:"6167201",hydrogenSubchannelId:t.storefrontId||"0",isPersistentCookie:!0,uniqToken:t.userId,visitToken:t.sessionId,microSessionId:t.pageId,microSessionCount:f,url:r.href,path:r.pathname,search:r.search,referrer:document.referrer,title:document.title,shopId:i(t.shopId),currency:t.currency,contentLanguage:t.acceptedLanguage};if(n=l({isMerchantRequest:Pe(),pageType:t.pageType,customerId:t.customerId},n),t.resourceId)try{n=l({resourceType:Ce(t.resourceId),resourceId:i(t.resourceId)},n)}catch{}return n}function Ae(e){f+=1;try{e&&e.shopify&&fe(e,h)}catch(r){console.error(`Error Shopify analytics: ${s.eventNames.ADD_TO_CART}
`,r)}}function Pe(){const e=location.hostname;return e.indexOf(Te)!==-1||e==="localhost"}function Ce(e=""){return e.substring(0,e.lastIndexOf("/")).replace(/.*shopify\//,"").toLowerCase()}const be=500;let g=[],u;function h(e){g.push(e),u&&(clearTimeout(u),u=null),u=setTimeout(()=>{const r={events:g,metadata:{event_sent_at_ms:Date.now()}};g=[],u=null;try{fetch("https://monorail-edge.shopifysvc.com/unstable/produce_batch",{method:"post",headers:{"content-type":"text/plain"},body:JSON.stringify(r)})}catch{}},be)}export{ke as ShopifyAnalyticsClient};
//# sourceMappingURL=79e32536.js.map
